# MongoDB
For this lab, we are going to make a few parts of an event database. You will create the first of these data modules, the module to handle a listing of events.

You will:

- Separate concerns into different modules.
- Store the database connection in one module.
- Define and store the database collections in another module.
- Define your Data manipulation functions in another module. 
- Continue practicing the usage of ```async / await``` for asynchronous code
- Continuing our exercises of linking these modules together as needed

# Packages you will use:

You will use the [mongodb](https://mongodb.github.io/node-mongodb-native/) package to hook into MongoDB
You may use the [lecture 4 code](https://github.com/stevens-cs546-cs554/CS-546/tree/master/lecture_04) as a guide.
You must save all dependencies you use to your package.json file

How to handle bad data

```Javascript
async function divideAsync(numerator, denominator) {
    if (typeof numerator !== "number") throw new Error("Numerator needs to be a number");
    if (typeof denominator !== "number") throw new Error("Denominator needs to be a number");

    if (denominator === 0) throw new Error("Cannot divide by 0!");
    
    return numerator / denominator;
}

async function main() {
    const six = await divideAsync(12, 2);
    console.log(six);
    
    try {
        const getAnError = await divideAsync("foo", 2);
    } catch(e) {
        console.log("Got an error!");
        console.log(e);
    }
    
}

main();
```

Would log:

```Javascript
6
"Got an error!"
"Numerator needs to be a number"
```

# Folder Structure
You will use the folder structure in the stub. for the data module and other project files. You can use mongoConnection.js,  mongoCollections.js and settings.json from the lecture code, however, you will need to modify settings.json and mongoCollections.js to meet this assignment's requirements. There is an extra file in the stub called helpers.js. You can add all your helper/validation functions in that file to use in your other modules.

# Database Structure
You will use a database with the following structure:

- The database will be called FirstName_LastName_lab4
- The collection you use will be called ```events```
events
The schema for an event is as followed:

```Javascript
{
    _id: ObjectId, 
    eventName: string,
    description: string,
    eventLocation: {streetAddress: string, city: string, state: string, zip: string}
    contactEmail: string,
    maxCapacity: number,
    priceOfAdmission: number,
    eventDate: string (string representation of a date),
    startTime: string (string representation of a time in 12 hour AM/PM format),
    endTime: string (string representation of a time in 12 hour AM/PM format),
    publicEvent: boolean
}
```

The ```_id``` field will be automatically generated by MongoDB when an event is inserted, so you do not need to provide it when an event is created.

An example of how Patrick's Big End of Summer BBQ would be stored in the DB:

```Javascript
{
    _id: ObjectId("507f1f77bcf86cd799439011"), 
    eventName: "Patrick's Big End of Summer BBQ",     
    description: "Come join us for our yearly end of summer bbq!",
    eventLocation: {streetAddress: "1 Castle Point Terrace", city: "Hoboken", state: "NJ", zip: "07030"}
    contactEmail: "phill@stevens.edu",
    maxCapacity: 30,
    priceOfAdmission: 0,
    eventDate: "08/25/2024",
    startTime: "2:00PM",
    endTime: "8:00PM",
    publicEvent: false
}
```

# events.js
In eventsjs, you will create and export five methods:

Remember, you must export methods named precisely as specified. The async keyword denotes that this is an async method. 

## async create(eventName, eventDescription, eventLocation, contactEmail, maxCapacity, priceOfAdmission, eventDate, startTime, endTime, publicEvent);
This async function will return to the newly created event object, with all of the properties listed above.
If ```eventName```, ```eventDescription```, ```eventLocation```, ```contactEmail```, ```maxCapacity```, ```priceOfAdmission```, ```eventDate```, ```startTime```, ```endTime```, ```publicEvent``` are not provided at all, the method should throw. (All fields need to have valid values);
If ```eventName```, ```eventDescription```, ```contactEmail```, ```eventDate```, ```startTime```, ```endTime``` are not ```strings``` or are empty strings, the method should throw. (strings with only spaces are not valid)
If ```eventName``` is less than 5 characters, the method should throw.
If ```eventDescription``` is less than 25 characters, the method should throw.
If ```contactEmail``` is not in a valid email address format, the method should throw (please research email address rules).
If ```eventDate``` is not a valid date in "MM/DD/YYYY" format. If it's not in the expected format or is not a valid date, the method should throw (09/31/2024 is not valid since there are not 31 days in Sept). 
The ```eventDate``` must be greater than the current date (so only future events can be created).
The ```startTime``` must be a valid time in 12-hour AM/PM format "11:30PM":  If it's not in the expected format or not a valid time, the method should throw. 
The ```startTime``` cannot be later than the ```endTime```, if it is, the method should throw.
The ```endTime``` must be a valid time in 12-hour AM/PM format "11:30PM":  If it's not in the expected format or not a valid time, the method should throw. 
The ```endTime``` cannot be earlier than the ```startTime```, if it is, the method should throw.
The ```endTim```e should be at least 30 minutes later than the ```startTime```, if it's not, the method should throw. 
If ```publicEvent``` is not a int he expected type (boolean), the method should throw.
if ```maxCapacity```, priceOfAdmission are not the expected type (numbers), the method should throw.
```maxCapacity``` should be a positive whole number > 0, if it's not, the method should throw.
```priceOfAdmission``` should be a positive whole number, positive 2 decimal place float or  0, if it's not, the method should throw. (a price of 0 would mean it's a free event, price can be a whole number ```25``` or a two decimal place float ```25.50```
If ```eventLocation``` is not an object,  the method should throw. 
If ```eventLocation.streetAddress```, ```eventLocation.city```,  ```eventLocation.state```,  ```eventLocation.zip```  are not supplied, the method should throw.
If ```eventLocation.streetAddress```, ```eventLocation.city```, ```eventLocation.state```, ```eventLocation.zip```  are not all valid strings, the method should throw.
If ```eventLocation.streetAddress```, is less than 3 characters, the method should throw.
If ```eventLocation.city```, is less than 3 characters, the method should throw. 
```eventLocation.state```, Must be a valid two character state abbreviation "NY", "NJ" etc..
If ```eventLocation.zip```, is not a string that contains 5 numbers, the method should throw. (only 5 digit zip but represented as a string, because leading 0's are valid in zip codes, yet JS drops leading 0's)

Note:  FOR ALL STRING INPUTS: Strings with empty spaces are NOT valid strings.  So no cases of "    " are valid.  You MUST trim all inputs that are strings

For example:

```Javascript
import * as events from "./events.js";
const patrickBBQ = await events.create("Patrick's Big End of Summer BBQ","Come join us for our yearly end of summer bbq!",{streetAddress: "1 Castle Point Terrace", city: "Hoboken", state: "NJ", zip: "07030"}, "phill@stevens.edu",30,0,"08/25/2024","2:00PM","8:00PM",false);
console.log(patrickBBQ);
```

Would return and log:

```Javascript
{    
     _id: "507f1f77bcf86cd799439011",      
    eventName: "Patrick's Big End of Summer BBQ",     
    description: "Come join us for our yearly end of summer bbq!",
    eventLocation: {streetAddress: "1 Castle Point Terrace", city: "Hoboken", state: "NJ", zip: "07030"},
    contactEmail: "phill@stevens.edu",
    maxCapacity: 30,
    priceOfAdmission: 0,
    eventDate: "08/25/2024",
    startTime: "2:00PM",
    endTime: "8:00PM",
    publicEvent: false
}
```

This event will be stored in the events collection.

If the event cannot be created, the method should throw.

Notice the output does not have ObjectId() around the ID field and no quotes around the key names, you need to display it as such.

## async getAll();
This function will return an array of all events in the collection.   If there are no events in your DB, this function will return an empty array

```Javascript
import * as events import "./events.js";
const allEvents = await events.getAll();
console.log(allEvents);
```

Would return and log all the events in the database.
```Javascript
[
  {  
    _id: "507f1f77bcf86cd799439011",      
    eventName: "Patrick's Big End of Summer BBQ",     
    description: "Come join us for our yearly end of summer bbq!",
    eventLocation: {streetAddress: "1 Castle Point Terrace", city: "Hoboken", state: "NJ", zip: "07030"},
    contactEmail: "phill@stevens.edu",
    maxCapacity: 30,
    priceOfAdmission: 0,
    eventDate: "08/25/2024",
    startTime: "2:00PM",
    endTime: "8:00PM",
    publicEvent: false
},
{
    _id: "507f1f77bcf86cd799439012",      
    eventName: "Aiden's Birthday Bash",          
    description: "Aiden turns 5 and you're all invited!",
    eventLocation: {streetAddress: "2 Castle Point Terrace", city: "Hoboken", state: "NJ", zip: "07030"},
    contactEmail: "ahill@stevens.edu",
    maxCapacity: 15,
    priceOfAdmission: 0,
    eventDate: "09/04/2024",
    startTime: "1:00PM",
    endTime: "4:00PM",
    publicEvent: false
}, 
{
    _id: "507f1f77bcf86cd799439013",      
    eventName: "Juniper Sky reunion concert!",          
    description: "The boys of Juniper Sky reunite for a one night only show at The Chance Theater in Poughkeepsie NY!",
    eventLocation: {streetAddress: "6 Crannell St", city: "Poughkeepsie", state: "NY", zip: "12601"},
    contactEmail: "js@juniperskyrocks.com",
    maxCapacity: 900,
    priceOfAdmission: 25,
    eventDate: "01/25/2024",
    startTime: "8:00PM",
    endTime: "10:00PM",
    publicEvent: true
} 
]
```
Notice the output does not have ObjectId() around the ID field and no quotes around the key names, you need to display it as such.

## async get(id);
When given an id, this function will return an event from the database.  

If no ```id``` is provided, the method should throw.
If the ```id``` provided is not a ```string```, or is an  empty string, the method should throw.
If the ```id```  provided is not a valid ```ObjectId```, the method should throw
If no events exists with that ```id```, the method should throw.

For example, you would use this method as:

```Javascript
import * as events from "./events.js";
const patricksBBQ = await events.get("507f1f77bcf86cd799439011"); 
console.log(patricksBBQ); 
```
Would return and log Patrick's Big End of Summer BBQ:

```Javascript
{   
    _id: "507f1f77bcf86cd799439011",      
    eventName: "Patrick's Big End of Summer BBQ",     
    description: "Come join us for our yearly end of summer bbq!",
    eventLocation: {streetAddress: "1 Castle Point Terrace", city: "Hoboken", state: "NJ", zip: "07030"},
    contactEmail: "phill@stevens.edu",
    maxCapacity: 30,
    priceOfAdmission: 0,
    eventDate: "08/25/2024",
    startTime: "2:00PM",
    endTime: "8:00PM",
    publicEvent: false
}
```
Notice the output does not have ObjectId() around the ID field and no quotes around the key names, you need to display it as such.

Make sure you trim the id input just in case it has any leading or trailing spaces but is otherwise valid.

Important note:  The ID field that MongoDB generates is an ```ObjectId```.  This function takes in a ```string``` representation of an ID as the ```id``` parameter.  You will need to convert it to an ```ObjectId``` in your function before you query the DB for the provided ID and then pass that converted value to your query. 

```Javascript
//We need to require ObjectId from mongo
let { ObjectId } = require('mongodb');


/*For demo purposes, I will create a new object ID and convert it to a string,
Then will pass that valid object ID string value into my function to check if it's a valid Object ID (which it is in this case)
I also pass in an invalid object ID when I call my function to show the error */


let newObjId = new ObjectId(); //creates a new object ID


let x = newObjId.toString(); // converts the Object ID to string


console.log(typeof x); //just logging x to see it's now type string


//The below function takes in a string value and then attempts to convert it to an ObjectId


function myDBfunction(id) {


  //check to make sure we have input at all
  if (!id) throw 'Id parameter must be supplied';


  //check to make sure it's a string
  if (typeof id !== 'string') throw "Id must be a string";


  //Now we check if it's a valid ObjectId so we attempt to convert a value to a valid object ID,
  //if it fails, you will throw an error 
  if (!ObjectId.isValid(id) throw "ID is not a valid Object ID";
  
  console.log('Valid Object ID, now I can pass ObjectId(id) as the ID into my query.');
}

//passing a valid string that can convert to an Object ID
try {
  myDBfunction(x);
} catch (e) {
  console.log(e.message);
}

//passing an invalid string that can't be converted into an object ID:
try {
  myDBfunction('test');
} catch (e) {
  console.log(e.message);
}
```

## async remove(id)
This function will remove the event from the database.

If no ```id``` is provided, the method should throw.
If the ```id``` provided is not a ```string```, or is an empty string the method should throw.
If the ```id``` provided is not a valid ```ObjectId```, the method should throw
If the event cannot be removed (does not exist), the method should throw.
If the removal succeeds, you will return an ```object``` in the following format:  ```{eventName: string_of event_name_value, deleted: true} //make sure deleted is a boolean and NOT a string!```

```Javascript
import * as events from "./events.js";
const removeAidensBDayBash = await events.remove("507f1f77bcf86cd799439012"); 
console.log(removeAidensBDayBash);
```

Would return and then log: ```{eventName: "Aiden's Birthday Bash", deleted: true}```

Make sure you trim the id input just in case it has any leading or trailing spaces but is otherwise valid.

Important note:  The ID field that MongoDB generates is an ```ObjectId```.  This function takes in a ```string``` representation of an ID as the ```id``` parameter.  You will need to convert it to an ```ObjectId``` in your function before you query the DB for the provided ID.  See example above in ```getId()```.

## async rename(id, newEventName)
This function will update the eventName field of the event currently in the database.

If no ```id``` is provided, the method should throw.
If the ```id``` provided is not a string, or is an empty ```string``` the method should throw.
If the ```id``` provided is not a valid ```ObjectId```, the method should throw.
If ```newEventName``` is not provided, the method should throw.
If ```newEventName``` is not a ```string```, or an empty string, the method should throw.
If ```newEventName``` is less than 5 characters, the method should throw.
If the event cannot be updated (does not exist), the method should throw.
If the ```newEventName``` is the same as the current value stored in the database, the method should throw. 
If the update succeeds, return the entire event object as it is after it is updated.

Note:  FOR ALL STRING INPUTS: Strings with empty spaces are NOT valid strings.  So no cases of "    " are valid.  You MUST trim all inputs that are strings (including ID)

```Javascript
import * as events from "./events.js";
const renamedAidensbdayBash = await events.rename("507f1f77bcf86cd799439012", "Aiden's 5th Birthday Bash"); 
console.log(renamedAidensbdayBash);
```

Would log the updated event:
```Javascript
{
    _id: "507f1f77bcf86cd799439012",      
    eventName: "Aiden's 5th Birthday Bash",     
    description: "Aiden turns 5 and you're all invited!",
    eventLocation: {streetAddress: "2 Castle Point Terrace", city: "Hoboken", state: "NJ", zip: "07030"}
    contactEmail: "ahill@stevens.edu",
    maxCapacity: 15,
    priceOfAdmission: 0,
    eventDate: "09/04/2024",
    startTime: "1:00PM",
    endTime: "4:00PM",
    publicEvent: false
}
```
Notice the output does not have ObjectId() around the ID field and no quotes around the key names, you need to display it as such.

Make sure you trim the id input just in case it has any leading or trailing spaces but is otherwise valid.

Important note:  The ID field that MongoDB generates is an ```ObjectId```.  This function takes in a ```string``` representation of an ID as the ```id``` parameter.  You will need to convert it to an ```ObjectId``` in your function before you query the DB for the provided ID.  See example above in ```getId()```.

# app.js
For your app.js file, you will:

1. Create a event of your choice.
2. Log the newly created event. (Just that event, not all events)
3. Create another event of your choice.
4. Query all events, and log them all
5. Create the 3rd event of your choice.
6. Log the newly created 3rd event. (Just that event, not all events)
7. Rename the first event
8. Log the first event with the updated name.
9. Remove the second event you created.
10. Query all events, and log them all
11. Try to create an event with bad input parameters to make sure it throws errors.
12. Try to remove an event that does not exist to make sure it throws errors.
13. Try to rename an event that does not exist to make sure it throws errors.
14. Try to rename an event passing in invalid data for the newEventName parameter to make sure it throws errors.
15. Try getting an event by ID that does not exist to make sure it throws errors.

# General Requirements
1. You must not submit your node_modules folder or package-lock.json
2. You must remember to save your dependencies to your package.json folder
3. You must do basic error checking in each function
4. Check for arguments existing and of proper type.
5. Throw if anything is out of bounds (ie, trying to perform an incalculable math operation or accessing data that does not exist)
6. If a function should return a promise, you should mark the method as an ```async``` function and return the value. Any promises you use inside of that, you should await to get their result values. If the promise should reject, then you should throw inside of that promise in order to return a rejected promise automatically. Thrown exceptions will bubble up from any awaited call that throws as well, unless they are caught in the async method.
7. You must remember to update your package.json file to set ```app.js``` as your starting script!
